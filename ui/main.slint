import { Button, VerticalBox, HorizontalBox, LineEdit, ComboBox, ScrollView, GridBox, GroupBox } from "std-widgets.slint";

export component MeasurementGuide inherits Rectangle {
    in property <string> title;
    in property <string> description;
    in property <string> measurement-site;
    in property <bool> is-male;
    in-out property <string> measurement: "";
    
    callback measurement-changed(string);
    
    background: #f5f5f5;
    border-radius: 8px;
    border-width: 1px;
    border-color: #ddd;
    min-height: 180px; // Ensure consistent height
    
    VerticalBox {
        padding: 16px;
        spacing: 12px;
        
        Text {
            text: title;
            font-size: 18px;
            font-weight: 700;
            color: #333;
            horizontal-alignment: left;
        }
        
        HorizontalBox {
            spacing: 16px;
            alignment: stretch;
            
            // Image section - fixed size
            Rectangle {
                width: 180px;
                height: 120px;
                background: #fff;
                border-radius: 4px;
                border-width: 1px;
                border-color: #ccc;
                
                if measurement-site == "chest" && is-male: Image {
                    source: @image-url("assets/m-skin-fold-test-chest.jpg");
                    width: 100%; height: 100%; image-fit: contain;
                }
                if measurement-site == "chest" && !is-male: Image {
                    source: @image-url("assets/f-skin-fold-test-chest.jpg");
                    width: 100%; height: 100%; image-fit: contain;
                }
                if measurement-site == "abdomen" && is-male: Image {
                    source: @image-url("assets/m-skin-fold-test-abdomen.jpg");
                    width: 100%; height: 100%; image-fit: contain;
                }
                if measurement-site == "abdomen" && !is-male: Image {
                    source: @image-url("assets/f-skin-fold-test-abdomen.jpg");
                    width: 100%; height: 100%; image-fit: contain;
                }
                if measurement-site == "thigh" && is-male: Image {
                    source: @image-url("assets/m-skin-fold-test-thigh.jpg");
                    width: 100%; height: 100%; image-fit: contain;
                }
                if measurement-site == "thigh" && !is-male: Image {
                    source: @image-url("assets/f-skin-fold-test-thigh.jpg");
                    width: 100%; height: 100%; image-fit: contain;
                }
                if measurement-site == "tricep" && is-male: Image {
                    source: @image-url("assets/m-skin-fold-test-tricep.jpg");
                    width: 100%; height: 100%; image-fit: contain;
                }
                if measurement-site == "tricep" && !is-male: Image {
                    source: @image-url("assets/f-skin-fold-test-tricep.jpg");
                    width: 100%; height: 100%; image-fit: contain;
                }
                if measurement-site == "subscapula" && is-male: Image {
                    source: @image-url("assets/m-skin-fold-test-subscapula.jpg");
                    width: 100%; height: 100%; image-fit: contain;
                }
                if measurement-site == "subscapula" && !is-male: Image {
                    source: @image-url("assets/f-skin-fold-test-subscapula.jpg");
                    width: 100%; height: 100%; image-fit: contain;
                }
                if measurement-site == "suprailiac" && is-male: Image {
                    source: @image-url("assets/m-skin-fold-test-suprailiac.jpg");
                    width: 100%; height: 100%; image-fit: contain;
                }
                if measurement-site == "suprailiac" && !is-male: Image {
                    source: @image-url("assets/f-skin-fold-test-suprailiac.jpg");
                    width: 100%; height: 100%; image-fit: contain;
                }
                if measurement-site == "midaxillary" && is-male: Image {
                    source: @image-url("assets/m-skin-fold-test-midaxillary.jpg");
                    width: 100%; height: 100%; image-fit: contain;
                }
                if measurement-site == "midaxillary" && !is-male: Image {
                    source: @image-url("assets/f-skin-fold-test-midaxillary.jpg");
                    width: 100%; height: 100%; image-fit: contain;
                }
            }
            
            // Description and input section - takes remaining space
            VerticalBox {
                spacing: 12px;
                alignment: stretch;
                
                Text {
                    text: description;
                    font-size: 14px;
                    color: #666;
                    wrap: word-wrap;
                    vertical-alignment: top;
                }
                
                HorizontalBox {
                    spacing: 8px;
                    alignment: start;
                    
                    Rectangle {
                        background: #fff;
                        border-radius: 4px;
                        border-width: 1px;
                        border-color: #ccc;
                        width: 120px;
                        height: 32px;
                        
                        LineEdit {
                            width: 100%;
                            height: 100%;
                            placeholder-text: "0.0";
                            text <=> measurement;
                            font-size: 14px;
                            edited => {
                                measurement-changed(self.text);
                            }
                        }
                    }
                    
                    Text {
                        text: "mm";
                        font-size: 14px;
                        color: #666;
                        vertical-alignment: center;
                    }
                }
            }
        }
    }
}

export component BodyFatCalculator inherits Window {
    title: "Body Fat Calculator";
    min-width: 950px;
    min-height: 800px; // Increased minimum height
    
    // Properties for form data
    in-out property <string> selected-gender: "Male";
    in-out property <string> age-input: "";
    in-out property <string> chest-measurement: "";
    in-out property <string> abdominal-measurement: "";
    in-out property <string> thigh-measurement: "";
    in-out property <string> triceps-measurement: "";
    in-out property <string> subscapular-measurement: "";
    in-out property <string> suprailiac-measurement: "";
    in-out property <string> midaxillary-measurement: "";
    
    // Result properties
    in-out property <string> result-text: "";
    in-out property <string> category-text: "";
    in-out property <bool> show-results: false;
    
    // Callbacks
    callback calculate-body-fat();
    callback measurement-updated(string, string);
    
    VerticalBox {
        padding: 20px;
        spacing: 20px;
        
        // Header
        Text {
            text: "Body Fat Calculator";
            font-size: 24px;
            font-weight: 700;
            color: #2c3e50;
            horizontal-alignment: center;
        }
        
        // Basic info section - more compact
        GroupBox {
            title: "Basic Information";
            min-height: 80px;
            
            HorizontalBox {
                spacing: 40px;
                alignment: center;
                padding: 16px;
                
                VerticalBox {
                    spacing: 8px;
                    alignment: center;
                    
                    Text {
                        text: "Gender:";
                        font-weight: 600;
                        font-size: 14px;
                    }
                    
                    ComboBox {
                        model: ["Male", "Female"];
                        current-value <=> selected-gender;
                        width: 120px;
                    }
                }
                
                VerticalBox {
                    spacing: 8px;
                    alignment: center;
                    
                    Text {
                        text: "Age:";
                        font-weight: 600;
                        font-size: 14px;
                    }
                    
                    Rectangle {
                        background: #fff;
                        border-radius: 4px;
                        border-width: 1px;
                        border-color: #ccc;
                        width: 120px;
                        height: 32px;
                        
                        LineEdit {
                            width: 100%;
                            height: 100%;
                            placeholder-text: "Enter age";
                            text <=> age-input;
                            font-size: 14px;
                        }
                    }
                }
            }
        }
        
        // Measurements section with better scrolling
        GroupBox {
            title: "Skinfold Measurements (7-Site Method)";
            
            ScrollView {
                height: 350px; // Fixed height for scroll area
                viewport-height: 1400px; // Explicit viewport height
                
                VerticalBox {
                    spacing: 16px;
                    padding: 8px;
                    
                    MeasurementGuide {
                        title: "1. Chest";
                        description: "Diagonal fold halfway between the nipple and shoulder crease";
                        measurement-site: "chest";
                        is-male: selected-gender == "Male";
                        measurement <=> chest-measurement;
                        measurement-changed => {
                            measurement-updated("chest", chest-measurement);
                        }
                    }
                    
                    MeasurementGuide {
                        title: "2. Abdominal";
                        description: "Vertical fold 2cm to the right of the umbilicus";
                        measurement-site: "abdomen";
                        is-male: selected-gender == "Male";
                        measurement <=> abdominal-measurement;
                        measurement-changed => {
                            measurement-updated("abdominal", abdominal-measurement);
                        }
                    }
                    
                    MeasurementGuide {
                        title: "3. Thigh";
                        description: "Vertical fold on the front of the thigh midway between hip and knee";
                        measurement-site: "thigh";
                        is-male: selected-gender == "Male";
                        measurement <=> thigh-measurement;
                        measurement-changed => {
                            measurement-updated("thigh", thigh-measurement);
                        }
                    }
                    
                    MeasurementGuide {
                        title: "4. Triceps";
                        description: "Vertical fold on the back of the arm midway between shoulder and elbow";
                        measurement-site: "tricep";
                        is-male: selected-gender == "Male";
                        measurement <=> triceps-measurement;
                        measurement-changed => {
                            measurement-updated("triceps", triceps-measurement);
                        }
                    }
                    
                    MeasurementGuide {
                        title: "5. Subscapular";
                        description: "Diagonal fold below the shoulder blade at 45-degree angle";
                        measurement-site: "subscapula";
                        is-male: selected-gender == "Male";
                        measurement <=> subscapular-measurement;
                        measurement-changed => {
                            measurement-updated("subscapular", subscapular-measurement);
                        }
                    }
                    
                    MeasurementGuide {
                        title: "6. Suprailiac";
                        description: "Diagonal fold above the hip bone along the natural line";
                        measurement-site: "suprailiac";
                        is-male: selected-gender == "Male";
                        measurement <=> suprailiac-measurement;
                        measurement-changed => {
                            measurement-updated("suprailiac", suprailiac-measurement);
                        }
                    }
                    
                    MeasurementGuide {
                        title: "7. Midaxillary";
                        description: "Vertical fold on the side of the torso below the armpit";
                        measurement-site: "midaxillary";
                        is-male: selected-gender == "Male";
                        measurement <=> midaxillary-measurement;
                        measurement-changed => {
                            measurement-updated("midaxillary", midaxillary-measurement);
                        }
                    }
                }
            }
        }
        
        // Calculate button - more prominent
        Rectangle {
            height: 50px;
            background: transparent;
            
            Button {
                text: "Calculate Body Fat Percentage";
                primary: true;
                // font-size: 16px;
                // font-weight: 600;
                width: 300px;
                height: 45px;
                clicked => {
                    calculate-body-fat();
                }
            }
        }
        
        // Results section - always visible with placeholder
        GroupBox {
            title: "Results";
            min-height: 120px;
            
            Rectangle {
                background: show-results ? #f8f9fa : #fafafa;
                border-radius: 8px;
                min-height: 80px;
                
                VerticalBox {
                    spacing: 12px;
                    alignment: center;
                    padding: 20px;
                    
                    if !show-results: Text {
                        text: "Enter your measurements and click 'Calculate' to see results";
                        font-size: 14px;
                        color: #6c757d;
                        horizontal-alignment: center;
                        font-italic: true;
                    }
                    
                    if show-results: Text {
                        text: result-text;
                        font-size: 20px;
                        font-weight: 700;
                        color: #2c3e50;
                        horizontal-alignment: center;
                    }
                    
                    if show-results: Text {
                        text: category-text;
                        font-size: 16px;
                        color: #34495e;
                        horizontal-alignment: center;
                        wrap: word-wrap;
                    }
                }
            }
        }
    }
}